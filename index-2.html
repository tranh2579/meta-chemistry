
<!DOCTYPE html>
<html lang="vi">
  <head>
    <title>Cân bằng phương trình hóa học!!!</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    />
  </head>
  <style>
    html{
        background-image: url(https://allimages.sgp1.digitaloceanspaces.com/tailieu247eduvn/2022/04/1651025193_58_99-Hinh-Nen-Meo-Cute-Dang-Yeu-Nhat-He-Mat.jpg);
    }
    .boxing-spling-etamy {
      height: 50 px;
      width: 50 px;
      align-items: center;
      display: flex;
      justify-items: center;
      background-color: #333,#4b00b3;
      float: right;
    }
</style>
  <body>
    <div class="container">
      <center><h3>Công cụ cân bằng phương trình hóa học</h3></center>
      <form action="#" method="get" onsubmit="doBalance(); return false;">
        <span style="width: 99%; display: flex; flex-direction: row">
          <input
            type="text"
            s
            id="inputFormula"
            class="form-control"
            autocomplete="off"
            placeholder="Nhập phương trình cần cân bằng " />
          <input
            type="submit"
            value="Cân bằng"
            class="btn btn-primary"
            style="margin-left: 0.3em" />
          <input
            type="button"
            class="btn btn-success"
            value="Ví dụ"
            onclick="doRandom();"
            style="margin-left: 0.3em"
        /></span>
        <span
          id="balanced"
          style="font-family: serif; font-size: 150%; line-height: 1.6"
        ></span
        ><span id="message"></span>
        <code id="codeOutput">&#xA0;</code>
      </form>
      <br />
      <h4>
        <span style="color: #ff0000">C</span
        ><span style="color: #f50009">â</span
        ><span style="color: #ec0012">n</span>
        <span style="color: #d90025">b</span
        ><span style="color: #cf002f">ằ</span
        ><span style="color: #c60038">n</span
        ><span style="color: #bc0042">g</span>
        <span style="color: #a90055">h</span
        ><span style="color: #a0005e">o</span
        ><span style="color: #970067">á</span>
        <span style="color: #84007a">h</span
        ><span style="color: #7a0084">ọ</span
        ><span style="color: #71008d">c</span>
        <span style="color: #5e00a0">b</span
        ><span style="color: #5400aa">ỗ</span
        ><span style="color: #4b00b3">n</span
        ><span style="color: #4200bc">g</span>
        <span style="color: #2f00cf">n</span
        ><span style="color: #2500d9">h</span
        ><span style="color: #1c00e2">i</span
        ><span style="color: #1200ec">ê</span
        ><span style="color: #0900f5">n</span>
        <span style="color: #0009f5">t</span
        ><span style="color: #0012ec">h</span
        ><span style="color: #001ce2">ấ</span
        ><span style="color: #0025d9">y</span>
        <span style="color: #0038c6">m</span
        ><span style="color: #0042bc">ì</span
        ><span style="color: #004bb3">n</span
        ><span style="color: #0055aa">h</span>
        <span style="color: #006797">q</span
        ><span style="color: #00718d">u</span
        ><span style="color: #007a84">á</span>
        <span style="color: #008d71">đ</span
        ><span style="color: #009767">ẹ</span
        ><span style="color: #00a05e">p</span>
        <span style="color: #00b34b">t</span
        ><span style="color: #00bc42">r</span
        ><span style="color: #00c638">a</span
        ><span style="color: #00cf2f">i</span>
        <span style="color: #00e21c">:</span
        ><span style="color: #00ec12">D</span
        ><span style="color: #00f509">D</span
        ><span style="color: #00ff02"> </span>
      </h4>
      <h4>
        <span style="color: #ff0000">V</span
        ><span style="color: #f0000e">ì</span>
        <span style="color: #d4002a">m</span
        ><span style="color: #c60038">ì</span
        ><span style="color: #b80046">n</span
        ><span style="color: #aa0055">h</span>
        <span style="color: #8d0071">đ</span
        ><span style="color: #7f007f">ã</span>
        <span style="color: #63009b">q</span
        ><span style="color: #5500aa">u</span
        ><span style="color: #4600b8">á</span>
        <span style="color: #2a00d4">t</span
        ><span style="color: #1c00e2">h</span
        ><span style="color: #0e00f0">í</span
        ><span style="color: #0600fe">c</span
        ><span style="color: #060ef0">h</span>
        <span style="color: #062ad4">c</span
        ><span style="color: #0638c6">ậ</span
        ><span style="color: #0646b8">u</span>
        <span style="color: #06639b">r</span
        ><span style="color: #06718d">ồ</span
        ><span style="color: #067f7f">i</span>
        <span style="color: #069b63">:</span
        ><span style="color: #06aa55">)</span
        ><span style="color: #06b846">)</span>
        <span style="color: #06d42a"><</span
        ><span style="color: #06e21c">3</span>
      </h4>
      <h4>
        <span style="color: #ff0000">P</span
        ><span style="color: #da0024">h</span
        ><span style="color: #b60048">ả</span
        ><span style="color: #91006d">i</span>
        <span style="color: #4800b6">l</span
        ><span style="color: #2400da">à</span
        ><span style="color: #0000ff">m</span>
        <span style="color: #0048b6">s</span
        ><span style="color: #006d91">a</span
        ><span style="color: #00916d">o</span>
        <span style="color: #00da24">~</span
        ><span style="color: #00ff00">~</span>
      </h4>
      <h4>
        <span style="color: #ff0000">P</span
        ><span style="color: #da0024">h</span
        ><span style="color: #b60048">ả</span
        ><span style="color: #91006d">i</span>
        <span style="color: #4800b6">l</span
        ><span style="color: #2400da">à</span
        ><span style="color: #0000ff">m</span>
        <span style="color: #0048b6">s</span
        ><span style="color: #006d91">a</span
        ><span style="color: #00916d">o</span>
        <span style="color: #00da24">~</span
        ><span style="color: #00ff00">~</span>
      </h4>
      <font color="black"
        ><h4>Email: trunganhvip074@gmail.com</h4>
        <h4>
          <h2 class="box"></h2>
          <a
            href="https://www.facebook.com/NguyenTrungAnh209/"
            target="_blank"
            rel="noopener noreferrer nofollow"
          >
            Facebook <33</a
          >
        </h4>
        <h4>
          <a
            href="https://github.com/tranh2579"
            target="_blank"
            rel="noopener noreferrer nofollow"
          >
            Github :3</a
          >
        </h4>
        <h4>
          <a
            href="https://www.facebook.com/hpa209"
            target="_blank"
            rel="noopener noreferrer nofollow"
            >My love -.-</a
          >
        </h4>
      </font>
      <h2>Hướng dẫn sử dụng trước khi dùng</h2>
      <figure id="syntax-guide" class="wp-block-table">
        <table>
          <thead>
            <tr>
              <th>&nbsp;</th>
              <th>Nhập vào</th>
              <th>Tool nhận biết</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Chỉ số</td>
              <td><code>N = N</code><strong>2</strong></td>
              <td>
                N<span class="rightarrow">&nbsp;→&nbsp;</span>N<sub>2</sub>
              </td>
            </tr>
            <tr>
              <td>Hợp chất</td>
              <td><code>H2 + O2 = </code><strong>H2O</strong></td>
              <td>
                H<sub>2</sub>&nbsp;+ O<sub>2</sub
                ><span class="rightarrow">&nbsp;→&nbsp;</span>H<sub>2</sub>O
              </td>
            </tr>
            <tr>
              <td>Nhóm</td>
              <td>
                <code>Mg</code><strong>(OH)</strong><code>2 = MgO + H2O</code>
              </td>
              <td>
                Mg(OH)<sub>2</sub
                ><span class="rightarrow">&nbsp;→&nbsp;</span>MgO +
                H<sub>2</sub>O
              </td>
            </tr>
            <tr>
              <td>Ion</td>
              <td>
                <code>H</code><strong>^+</strong><code> + CO3</code
                ><strong>^2-</strong><code> = H2O + CO2</code>
              </td>
              <td>
                H<sup>+</sup>&nbsp;+ CO<sub>3</sub><sup>2−</sup
                ><span class="rightarrow">&nbsp;→&nbsp;</span>H<sub>2</sub>O +
                CO<sub>2</sub>
              </td>
            </tr>
            <tr>
              <td>Electron</td>
              <td><code>Fe^3+ + </code><strong>e</strong><code> = Fe</code></td>
              <td>
                Fe<sup>3+</sup>&nbsp;+ e<sup>−</sup
                ><span class="rightarrow">&nbsp;→&nbsp;</span>Fe
              </td>
            </tr>
            <tr>
              <td>Không dấu cách</td>
              <td><code>A3^-+B2^2+=A5B+e</code></td>
              <td>
                A<sub>3</sub><sup>−</sup>&nbsp;+ B<sub>2</sub><sup>2+</sup
                ><span class="rightarrow">&nbsp;→&nbsp;</span>A<sub>5</sub>B +
                e<sup>−</sup>
              </td>
            </tr>
            <tr>
              <td>Có dấu cách</td>
              <td><code>C 3 H 5 ( O H ) 3 + O 2 = H 2 O + C O 2</code></td>
              <td>
                C<sub>3</sub>H<sub>5</sub>(OH)<sub>3</sub>&nbsp;+ O<sub>2</sub
                ><span class="rightarrow">&nbsp;→&nbsp;</span>H<sub>2</sub>O +
                CO<sub>2</sub>
              </td>
            </tr>
            <tr>
              <td>Optional 1</td>
              <td>
                <code>H</code><strong>1</strong><code>^</code><strong>1</strong
                ><code>+ + e = H</code><strong>1</strong><code>^</code
                ><strong>1</strong><code>-</code>
              </td>
              <td>
                H<sup>+</sup>&nbsp;+ e<sup>−</sup
                ><span class="rightarrow">&nbsp;→&nbsp;</span>H<sup>−</sup>
              </td>
            </tr>
            <tr>
              <td>Ký tự linh hoạt</td>
              <td>
                <code></code><strong>Foo</strong><code>^5+ + </code
                ><strong>Bar</strong><code>^3- = </code><strong>Foo</strong
                ><code></code><strong>Bar</strong><code>2 + </code
                ><strong>Foo</strong><code></code><strong>Bar</strong
                ><code>^-</code>
              </td>
              <td>
                Foo<sup>5+</sup>&nbsp;+ Bar<sup>3−</sup
                ><span class="rightarrow">&nbsp;→&nbsp;</span
                >FooBar<sub>2</sub>&nbsp;+ FooBar<sup>−</sup>
              </td>
            </tr>
          </tbody>
        </table>
      </figure>
      <script type="application/javascript">
        "use strict";
        var formulaElem = document.getElementById("inputFormula");
        function doBalance() {
          var msgElem = document.getElementById("message");
          var balancedElem = document.getElementById("balanced");
          var codeOutElem = document.getElementById("codeOutput");
          msgElem.textContent = "";
          while (balancedElem.firstChild != null)
            balancedElem.removeChild(balancedElem.firstChild);
          while (codeOutElem.firstChild != null)
            codeOutElem.removeChild(codeOutElem.firstChild);
          codeOutElem.textContent = " ";
          var formulaStr = formulaElem.value;
          var eqn;
          try {
            eqn = new Parser(formulaStr).parseEquation();
          } catch (e) {
            if (typeof e == "string") {
              msgElem.textContent = "Syntax error: " + e;
            } else if ("start" in e) {
              msgElem.textContent = "Syntax error: " + e.message;
              var start = e.start;
              var end = "end" in e ? e.end : e.start;
              while (
                end > start &&
                [" ", "\t"].indexOf(formulaStr.charAt(end - 1)) != -1
              )
                end--;
              if (start == end) end++;
              codeOutElem.textContent += formulaStr.substr(0, start);
              if (end <= formulaStr.length) {
                codeOutElem.appendChild(
                  createElem("u", formulaStr.substring(start, end))
                );
                codeOutElem.appendChild(
                  document.createTextNode(
                    formulaStr.substring(end, formulaStr.length)
                  )
                );
              } else codeOutElem.appendChild(createElem("u", " "));
            } else {
              msgElem.textContent = "Assertion error";
            }
            return;
          }
          try {
            var matrix = buildMatrix(eqn);
            solve(matrix);
            var coefs = extractCoefficients(matrix);
            checkAnswer(eqn, coefs);
            balancedElem.appendChild(eqn.toHtml(coefs));
          } catch (e) {
            msgElem.textContent = e.toString();
          }
        }
        function doDemo(formulaStr) {
          formulaElem.value = formulaStr;
          doBalance();
        }
        var RANDOM_DEMOS = [
          "H2 + O2 = H2O",
          "Fe + O2 = Fe2O3",
          "NH3 + O2 = N2 + H2O",
          "C2H2 + O2 = CO2 + H2O",
          "C3H8O + O2 = CO2 + H2O",
          "Na + O2 = Na2O",
          "P4 + O2 = P2O5",
          "Na2O + H2O = NaOH",
          "Mg + HCl = MgCl2 + H2",
          "AgNO3 + LiOH = AgOH + LiNO3",
          "Pb + PbO2 + H^+ + SO4^2- = PbSO4 + H2O",
          "HNO3 + Cu = Cu(NO3)2 + H2O + NO",
          "KNO2 + KNO3 + Cr2O3 = K2CrO4 + NO",
          "AgNO3 + BaCl2 = Ba(NO3)2 + AgCl",
          "Cu(NO3)2 = CuO + NO2 + O2",
          "Al + CuSO4 = Al2(SO4)3 + Cu",
          "Na3PO4 + Zn(NO3)2 = NaNO3 + Zn3(PO4)2",
          "Cl2 + Ca(OH)2 = Ca(ClO)2 + CaCl2 + H2O",
          "CHCl3 + O2 = CO2 + H2O + Cl2",
          "H2C2O4 + MnO4^- = H2O + CO2 + MnO + OH^-",
          "H2O2 + Cr2O7^2- = Cr^3+ + O2 + OH^-",
          "KBr + KMnO4 + H2SO4 = Br2 + MnSO4 + K2SO4 + H2O",
          "K2Cr2O7 + KI + H2SO4 = Cr2(SO4)3 + I2 + H2O + K2SO4",
          "KClO3 + KBr + HCl = KCl + Br2 + H2O",
          "Ag + HNO3 = AgNO3 + NO + H2O",
          "P4 + OH^- + H2O = H2PO2^- + P2H4",
          "Zn + NO3^- + H^+ = Zn^2+ + NH4^+ + H2O",
          "ICl + H2O = Cl^- + IO3^- + I2 + H^+",
          "AB2 + AC3 + AD5 + AE7 + AF11 + AG13 + AH17 + AI19 + AJ23 = A + ABCDEFGHIJ",
        ];
        var lastRandomIndex = -1;
        function doRandom() {
          var index;
          do {
            index = Math.floor(Math.random() * RANDOM_DEMOS.length);
            index = Math.max(Math.min(index, RANDOM_DEMOS.length - 1), 0);
          } while (RANDOM_DEMOS.length >= 2 && index == lastRandomIndex);
          lastRandomIndex = index;
          doDemo(RANDOM_DEMOS[index]);
        }
        var Parser = (function () {
          function Parser(formulaStr) {
            this.tok = new Tokenizer(formulaStr);
          }
          Parser.prototype.parseEquation = function () {
            var lhs = [this.parseTerm()];
            while (true) {
              var next = this.tok.peek();
              if (next == "+") {
                this.tok.consume(next);
                lhs.push(this.parseTerm());
              } else if (next == "=") {
                this.tok.consume(next);
                break;
              } else
                throw {
                  message: "Ko tìm thấy dấu bằng hoặc dấu cộng á :v ",
                  start: this.tok.pos,
                };
            }
            var rhs = [this.parseTerm()];
            while (true) {
              var next = this.tok.peek();
              if (next == null) break;
              else if (next == "+") {
                this.tok.consume(next);
                rhs.push(this.parseTerm());
              } else
                throw {
                  message: "Cộng hoặc kết thúc phương trình ko hợp lệ",
                  start: this.tok.pos,
                };
            }
            return new Equation(lhs, rhs);
          };

          Parser.prototype.parseTerm = function () {
            var startPos = this.tok.pos;

            var items = [];
            var electron = false;
            var next;
            while (true) {
              next = this.tok.peek();
              if (next == "(") items.push(this.parseGroup());
              else if (next == "e") {
                this.tok.consume(next);
                electron = true;
              } else if (next != null && /^[A-Z][a-z]*$/.test(next))
                items.push(this.parseElement());
              else if (next != null && /^[0-9]+$/.test(next))
                throw {
                  message: "Nhận dạng không hợp lệ - số lượng không xác định",
                  start: this.tok.pos,
                };
              else break;
            }

            var charge = null;
            if (next == "^") {
              this.tok.consume(next);
              next = this.tok.peek();
              if (next == null)
                throw {
                  message: "Lỗi: Số hoặc dấu hiệu hông tìm thấy",
                  start: this.tok.pos,
                };
              else {
                charge = this.parseOptionalNumber();
                next = this.tok.peek();
              }
              if (next == "+") charge = +charge;
              else if (next == "-") charge = -charge;
              else
                throw {
                  message: "Lỗi: Dấu hiệu nhận dạng humm tìmmm thấyyy ",
                  start: this.tok.pos,
                };
              this.tok.take();
            }

            if (electron) {
              if (items.length > 0)
                throw {
                  message:
                    "Thuật ngữ không hợp lệ - Lỗi: Số electron cần đứng cô đơn một mình",
                  start: startPos,
                  end: this.tok.pos,
                };
              if (charge == null) charge = -1;
              if (charge != -1)
                throw {
                  message: "Thuật ngữ không hợp lệ - Điện tích hok hợp lệ",
                  start: startPos,
                  end: this.tok.pos,
                };
            } else {
              if (items.length == 0)
                throw {
                  message: "Lỗi cụm từ không hợp lệ hoặc trống",
                  start: startPos,
                  end: this.tok.pos,
                };
              if (charge == null) charge = 0;
            }
            return new Term(items, charge);
          };

          Parser.prototype.parseGroup = function () {
            var startPos = this.tok.pos;
            this.tok.consume("(");
            var items = [];
            while (true) {
              var next = this.tok.peek();
              if (next == "(") items.push(this.parseGroup());
              else if (next != null && /^[A-Z][a-z]*$/.test(next))
                items.push(this.parseElement());
              else if (next == ")") {
                this.tok.consume(next);
                if (items.length == 0)
                  throw {
                    message: "nhóm trống",
                    start: startPos,
                    end: this.tok.pos,
                  };
                break;
              } else
                throw {
                  message:
                    "Phần tử, nhóm hoặc dấu ngoặc đóng ko lường trước được (bẻ lái quá ghê )  ",
                  start: this.tok.pos,
                };
            }
            return new Group(items, this.parseOptionalNumber());
          };
          Parser.prototype.parseElement = function () {
            var name = this.tok.take();
            if (!/^[A-Z][a-z]*$/.test(name)) throw "Lỗi xác nhận";
            return new ChemElem(name, this.parseOptionalNumber());
          };

          Parser.prototype.parseOptionalNumber = function () {
            var next = this.tok.peek();
            if (next != null && /^[0-9]+$/.test(next))
              return checkedParseInt(this.tok.take());
            else return 1;
          };
          return Parser;
        })();
        var Tokenizer = (function () {
          function Tokenizer(str) {
            this.str = str.replace(/\u2212/g, "-");
            this.pos = 0;
            this.skipSpaces();
          }
          Tokenizer.prototype.peek = function () {
            if (this.pos == this.str.length) return null;
            var match = /^([A-Za-z][a-z]*|[0-9]+|[+\-^=()])/.exec(
              this.str.substring(this.pos)
            );
            if (match == null)
              throw { message: "Biểu tượng ko hợp lệ", start: this.pos };
            return match[0];
          };
          Tokenizer.prototype.take = function () {
            var result = this.peek();
            if (result == null)
              throw "Tiến xa hơn mã thông báo cuối cùng(lỗi mà e cx chả bt lỗi là j :v )";
            this.pos += result.length;
            this.skipSpaces();
            return result;
          };
          Tokenizer.prototype.consume = function (s) {
            if (this.take() != s) throw "mã thông báo không khớp";
          };
          Tokenizer.prototype.skipSpaces = function () {
            var match = /^[ \t]*/.exec(this.str.substring(this.pos));
            if (match === null) throw "Lỗi xác nhận";
            this.pos += match[0].length;
          };
          return Tokenizer;
        })();
        var Equation = (function () {
          function Equation(lhs, rhs) {
            this.leftSide = lhs.slice();
            this.rightSide = rhs.slice();
          }
          Equation.prototype.getElements = function () {
            var result = new Set();
            for (
              var _i = 0, _a = this.leftSide.concat(this.rightSide);
              _i < _a.length;
              _i++
            ) {
              var item = _a[_i];
              item.getElements(result);
            }
            return Array.from(result);
          };
          Equation.prototype.toHtml = function (coefs) {
            if (
              coefs !== undefined &&
              coefs.length != this.leftSide.length + this.rightSide.length
            )
              throw "Số lượng hệ số không khớp";
            var node = document.createDocumentFragment();
            var j = 0;
            function termsToHtml(terms) {
              var head = true;
              for (var _i = 0, terms_1 = terms; _i < terms_1.length; _i++) {
                var term = terms_1[_i];
                var coef = coefs !== undefined ? coefs[j] : 1;
                if (coef != 0) {
                  if (head) head = false;
                  else node.appendChild(createSpan("plus", " + "));
                  if (coef != 1) {
                    var span = createSpan(
                      "coefficient",
                      coef.toString().replace(/-/, MINUS)
                    );
                    if (coef < 0) span.classList.add("negative");
                    node.appendChild(span);
                  }
                  node.appendChild(term.toHtml());
                }
                j++;
              }
            }
            termsToHtml(this.leftSide);
            node.appendChild(createSpan("rightarrow", " \u2192 "));
            termsToHtml(this.rightSide);
            return node;
          };
          return Equation;
        })();
        var Term = (function () {
          function Term(items, charge) {
            if (items.length == 0 && charge != -1) throw "Không hợp lệ ";
            this.items = items.slice();
            this.charge = charge;
          }
          Term.prototype.getElements = function (resultSet) {
            resultSet.add("e");
            for (var _i = 0, _a = this.items; _i < _a.length; _i++) {
              var item = _a[_i];
              item.getElements(resultSet);
            }
          };
          Term.prototype.countElement = function (name) {
            if (name == "e") {
              return -this.charge;
            } else {
              var sum = 0;
              for (var _i = 0, _a = this.items; _i < _a.length; _i++) {
                var item = _a[_i];
                sum = checkedAdd(sum, item.countElement(name));
              }
              return sum;
            }
          };
          Term.prototype.toHtml = function () {
            var node = createSpan("term");
            if (this.items.length == 0 && this.charge == -1) {
              node.textContent = "e";
              node.appendChild(createElem("sup", MINUS));
            } else {
              for (var _i = 0, _a = this.items; _i < _a.length; _i++) {
                var item = _a[_i];
                node.appendChild(item.toHtml());
              }
              if (this.charge != 0) {
                var s = void 0;
                if (Math.abs(this.charge) == 1) s = "";
                else s = Math.abs(this.charge).toString();
                if (this.charge > 0) s += "+";
                else s += MINUS;
                node.appendChild(createElem("sup", s));
              }
            }
            return node;
          };
          return Term;
        })();
        var Group = (function () {
          function Group(items, count) {
            if (count < 1) throw "Số lượng phải là số nguyên dương";
            this.items = items.slice();
            this.count = count;
          }
          Group.prototype.getElements = function (resultSet) {
            for (var _i = 0, _a = this.items; _i < _a.length; _i++) {
              var item = _a[_i];
              item.getElements(resultSet);
            }
          };
          Group.prototype.countElement = function (name) {
            var sum = 0;
            for (var _i = 0, _a = this.items; _i < _a.length; _i++) {
              var item = _a[_i];
              sum = checkedAdd(
                sum,
                checkedMultiply(item.countElement(name), this.count)
              );
            }
            return sum;
          };
          Group.prototype.toHtml = function () {
            var node = createSpan("group", "(");
            for (var _i = 0, _a = this.items; _i < _a.length; _i++) {
              var item = _a[_i];
              node.appendChild(item.toHtml());
            }
            node.appendChild(document.createTextNode(")"));
            if (this.count != 1)
              node.appendChild(createElem("sub", this.count.toString()));
            return node;
          };
          return Group;
        })();
        var ChemElem = (function () {
          function ChemElem(name, count) {
            if (count < 1) throw "Số lượng phải là số nguyên dương";
            this.name = name;
            this.count = count;
          }
          ChemElem.prototype.getElements = function (resultSet) {
            resultSet.add(this.name);
          };
          ChemElem.prototype.countElement = function (n) {
            return n == this.name ? this.count : 0;
          };
          ChemElem.prototype.toHtml = function () {
            var node = createSpan("element", this.name);
            if (this.count != 1)
              node.appendChild(createElem("sub", this.count.toString()));
            return node;
          };
          return ChemElem;
        })();
        var Matrix = (function () {
          function Matrix(rows, cols) {
            if (rows < 0 || cols < 0)
              throw "Lập luận của thằng xoắn não(nói chung là vô lý) ";
            this.numRows = rows;
            this.numCols = cols;

            var row = [];
            for (var j = 0; j < cols; j++) row.push(0);
            this.cells = [];
            for (var i = 0; i < rows; i++) this.cells.push(row.slice());
          }

          Matrix.prototype.get = function (r, c) {
            if (r < 0 || r >= this.numRows || c < 0 || c >= this.numCols)
              throw "Index out of bounds";
            return this.cells[r][c];
          };

          Matrix.prototype.set = function (r, c, val) {
            if (r < 0 || r >= this.numRows || c < 0 || c >= this.numCols)
              throw "Index out of bounds";
            this.cells[r][c] = val;
          };

          Matrix.prototype.swapRows = function (i, j) {
            if (i < 0 || i >= this.numRows || j < 0 || j >= this.numRows)
              throw "Index out of bounds";
            var temp = this.cells[i];
            this.cells[i] = this.cells[j];
            this.cells[j] = temp;
          };

          Matrix.addRows = function (x, y) {
            var z = [];
            for (var i = 0; i < x.length; i++) z.push(checkedAdd(x[i], y[i]));
            return z;
          };

          Matrix.multiplyRow = function (x, c) {
            return x.map(function (val) {
              return checkedMultiply(val, c);
            });
          };

          Matrix.gcdRow = function (x) {
            var result = 0;
            for (var _i = 0, x_1 = x; _i < x_1.length; _i++) {
              var val = x_1[_i];
              result = gcd(val, result);
            }
            return result;
          };
          Matrix.simplifyRow = function (x) {
            var sign = 0;
            for (var _i = 0, x_2 = x; _i < x_2.length; _i++) {
              var val = x_2[_i];
              if (val != 0) {
                sign = Math.sign(val);
                break;
              }
            }
            if (sign == 0) return x.slice();
            var g = Matrix.gcdRow(x) * sign;
            return x.map(function (val) {
              return val / g;
            });
          };

          Matrix.prototype.gaussJordanEliminate = function () {
            var cells = (this.cells = this.cells.map(Matrix.simplifyRow));

            var numPivots = 0;
            for (var i = 0; i < this.numCols; i++) {
              var pivotRow = numPivots;
              while (pivotRow < this.numRows && cells[pivotRow][i] == 0)
                pivotRow++;
              if (pivotRow == this.numRows) continue;
              var pivot = cells[pivotRow][i];
              this.swapRows(numPivots, pivotRow);
              numPivots++;

              for (var j = numPivots; j < this.numRows; j++) {
                var g = gcd(pivot, cells[j][i]);
                cells[j] = Matrix.simplifyRow(
                  Matrix.addRows(
                    Matrix.multiplyRow(cells[j], pivot / g),
                    Matrix.multiplyRow(cells[i], -cells[j][i] / g)
                  )
                );
              }
            }

            for (var i = this.numRows - 1; i >= 0; i--) {
              var pivotCol = 0;
              while (pivotCol < this.numCols && cells[i][pivotCol] == 0)
                pivotCol++;
              if (pivotCol == this.numCols) continue;
              var pivot = cells[i][pivotCol];

              for (var j = i - 1; j >= 0; j--) {
                var g = gcd(pivot, cells[j][pivotCol]);
                cells[j] = Matrix.simplifyRow(
                  Matrix.addRows(
                    Matrix.multiplyRow(cells[j], pivot / g),
                    Matrix.multiplyRow(cells[i], -cells[j][pivotCol] / g)
                  )
                );
              }
            }
          };
          return Matrix;
        })();

        function buildMatrix(eqn) {
          var elems = eqn.getElements();
          var lhs = eqn.leftSide;
          var rhs = eqn.rightSide;
          var matrix = new Matrix(
            elems.length + 1,
            lhs.length + rhs.length + 1
          );
          elems.forEach(function (elem, i) {
            var j = 0;
            for (var _i = 0, lhs_1 = lhs; _i < lhs_1.length; _i++) {
              var term = lhs_1[_i];
              matrix.set(i, j, term.countElement(elem));
              j++;
            }
            for (var _a = 0, rhs_1 = rhs; _a < rhs_1.length; _a++) {
              var term = rhs_1[_a];
              matrix.set(i, j, -term.countElement(elem));
              j++;
            }
          });
          return matrix;
        }
        function solve(matrix) {
          matrix.gaussJordanEliminate();
          function countNonzeroCoeffs(row) {
            var count = 0;
            for (var i_1 = 0; i_1 < matrix.numCols; i_1++) {
              if (matrix.get(row, i_1) != 0) count++;
            }
            return count;
          }

          var i;
          for (i = 0; i < matrix.numRows - 1; i++) {
            if (countNonzeroCoeffs(i) > 1) break;
          }
          if (i == matrix.numRows - 1)
            throw "Sai phương trình hoặc do máy bạn pha ke nên sai:v (Thật ra là chương trình pha ke :v hoặc do bạn viết phương trình quá gà 😏 )  ";

          matrix.set(matrix.numRows - 1, i, 1);
          matrix.set(matrix.numRows - 1, matrix.numCols - 1, 1);
          matrix.gaussJordanEliminate();
        }
        function extractCoefficients(matrix) {
          var rows = matrix.numRows;
          var cols = matrix.numCols;
          if (cols - 1 > rows || matrix.get(cols - 2, cols - 2) == 0)
            throw "Nhiều giải pháp độc lập(có nghĩa là một phương trình có nhìu hệ số khác nhau)";
          var lcm = 1;
          for (var i = 0; i < cols - 1; i++)
            lcm = checkedMultiply(
              lcm / gcd(lcm, matrix.get(i, i)),
              matrix.get(i, i)
            );
          var coefs = [];
          var allzero = true;
          for (var i = 0; i < cols - 1; i++) {
            var coef = checkedMultiply(
              lcm / matrix.get(i, i),
              matrix.get(i, cols - 1)
            );
            coefs.push(coef);
            allzero = allzero && coef == 0;
          }
          if (allzero) throw "Lỗi xác nhận: Giải pháp hoàn toàn không có";
          return coefs;
        }

        function checkAnswer(eqn, coefs) {
          if (coefs.length != eqn.leftSide.length + eqn.rightSide.length)
            throw "Lỗi xác nhận: Độ dài không khớp";
          var allzero = true;
          for (var _i = 0, coefs_1 = coefs; _i < coefs_1.length; _i++) {
            var coef = coefs_1[_i];
            if (
              typeof coef != "number" ||
              isNaN(coef) ||
              Math.floor(coef) != coef
            )
              throw "Lỗi xác nhận: Không phải số nguyên";
            allzero = allzero && coef == 0;
          }
          if (allzero) throw "Lỗi xác nhận: Không có giải pháp nào cả :v ";
          for (var _a = 0, _b = eqn.getElements(); _a < _b.length; _a++) {
            var elem = _b[_a];
            var sum = 0;
            var j = 0;
            for (var _c = 0, _d = eqn.leftSide; _c < _d.length; _c++) {
              var term = _d[_c];
              sum = checkedAdd(
                sum,
                checkedMultiply(term.countElement(elem), coefs[j])
              );
              j++;
            }
            for (var _e = 0, _f = eqn.rightSide; _e < _f.length; _e++) {
              var term = _f[_e];
              sum = checkedAdd(
                sum,
                checkedMultiply(term.countElement(elem), -coefs[j])
              );
              j++;
            }
            if (sum != 0) throw "Lỗi xác nhận: Số dư không chính xác";
          }
        }

        var INT_MAX = 9007199254740992;

        function checkedParseInt(str) {
          var result = parseInt(str, 10);
          if (isNaN(result)) throw "Không phải là một số";
          return checkOverflow(result);
        }

        function checkedAdd(x, y) {
          return checkOverflow(x + y);
        }

        function checkedMultiply(x, y) {
          return checkOverflow(x * y);
        }

        function checkOverflow(x) {
          if (Math.abs(x) >= INT_MAX) throw "Tràn dữ liệu số học";
          return x;
        }

        function gcd(x, y) {
          if (
            typeof x != "number" ||
            typeof y != "number" ||
            isNaN(x) ||
            isNaN(y)
          )
            throw "đối số không hợp lệ";
          x = Math.abs(x);
          y = Math.abs(y);
          while (y != 0) {
            var z = x % y;
            x = y;
            y = z;
          }
          return x;
        }

        var MINUS = "\u2212";

        function createElem(tagName, text) {
          var result = document.createElement(tagName);
          if (text !== undefined) result.textContent = text;
          return result;
        }

        function createSpan(cls, text) {
          var result = createElem("span", text);
          result.className = cls;
          return result;
        }

        if (!("sign" in Math))
          Math.sign = function (x) {
            return x > 0 ? 1 : x < 0 ? -1 : 0;
          };
        if (!("from" in Array)) {
          Array.from = function (set) {
            var result = [];
            set.forEach(function (obj) {
              return result.push(obj);
            });
            return result;
          };
        }
      </script>
    </div>
  </body>
</html>